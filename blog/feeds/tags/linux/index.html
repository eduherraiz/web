<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>www.eduherraiz.com - Entradas del tag linux</title><link>http://www.eduherraiz.com/blog/tags/linux/</link><description>Las últimas entradas del tag linux</description><atom:link href="http://www.eduherraiz.com/blog/feeds/tags/linux/" rel="self"></atom:link><language>es</language><copyright>Zinnia</copyright><lastBuildDate>Tue, 28 Jun 2011 11:17:18 +0000</lastBuildDate><item><title>Script para sincronizar carpeta remota vía rsync
</title><link>http://www.eduherraiz.com/blog/2011/06/28/script-para-sincronizar-carpeta-remota-via-rsync/</link><description>&lt;p&gt;Ayer me propuse&amp;nbsp; sincronizar la carpeta de series del servidor de disco con el disco de m&amp;iacute; nuevo &lt;a href="http://en.wikipedia.org/wiki/Home_theater_PC"&gt;HTPC&lt;/a&gt;. Pens&amp;eacute; que era necesario hacer algo para que esteń siempre sincronizadas los dos directorios, as&amp;iacute; cuando descargue nuevos cap&amp;iacute;tulos no tendr&amp;eacute; que actualizarlo a mano. Busqu&amp;eacute; alguna soluci&amp;oacute;n entre las aplicaciones que hacen backups, pero no encontr&amp;eacute; algo sencillo y me decid&amp;iacute; a hacer un script cutre en bash utilizando el cl&amp;aacute;sico rsync para sincronizar. Problemas que resuelve el script:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Comprueba que el script no haya sido lanzado ya.&lt;/li&gt;
	&lt;li&gt;Comprueba que el HTPC est&amp;eacute; encendido, haciendo ping.&lt;/li&gt;
	&lt;li&gt;Espera un tiempo prudencial 60 segundos, por si el HTPC acaba de encenderse y as&amp;iacute; dar tiempo a arrancar el sistema.&lt;/li&gt;
	&lt;li&gt;Lanza el rsync para sincronizar las dos carpetas remotas. En este caso el script se inicia en el servidor de disco, pero solo habr&amp;iacute;a que modificar el comando rsync si queremos hacerlo desde el otro lado.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Dependencias:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Tener instalado el comando fping:&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;aptitude install fping&lt;/blockquote&gt;

&lt;ul&gt;
	&lt;li&gt;Permitir el login sin password del servidor de disco al HTPC, pod&amp;eacute;is seguir este manual que me funcion&amp;oacute; a m&amp;iacute;:&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;&lt;a href="http://libtronics.com/2011/06/ssh-login-without-password/"&gt;http://libtronics.com/2011/06/ssh-login-without-password/&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;Y este es el script:&lt;/p&gt;

&lt;pre class="brush:php"&gt;
#!/bin/bash
FILE=/tmp/mirroring-xbmc

if [ -e $FILE ]
then
                exit # THe program is running
else
        touch $FILE
        status=`fping 192.168.1.20 | cut -d &amp;#39; &amp;#39; -f 3`
        if [ $status == &amp;quot;alive&amp;quot; ]
        then
                sleep 60
                rsync -azC --force --delete --progress -e &amp;quot;ssh -p22&amp;quot; /mnt/xuflus/Series/ xbmc@192.168.1.20:/home/xbmc/Series/
        fi
        rm $FILE
fi&lt;/pre&gt;

&lt;p&gt;Guardamos el script en /usr/bin/mirroring-xbmc, le damos permisos de ejecuci&amp;oacute;n:&lt;/p&gt;

&lt;blockquote&gt;chmod +x /usr/bin/mirroring-xbmc&lt;/blockquote&gt;

&lt;p&gt;Ya solo queda incluirlo en el crontab para que se ejecute cada cierto tiempo:&lt;/p&gt;

&lt;blockquote&gt;crontab -e&lt;/blockquote&gt;

&lt;p&gt;Y a&amp;ntilde;adir esta linea (se ejecutar&amp;aacute; cada diez minutos):&lt;/p&gt;

&lt;blockquote&gt;*/10 * * * * mirroring-xbmc&lt;/blockquote&gt;

&lt;p&gt;Seguro que es reinventar la rueda, y creo que se deber&amp;iacute;a hacer como un daemon de ubuntu, con la estructura correcta en /etc/init.d . Pero como para m&amp;iacute; es funcional lo voy a dejar as&amp;iacute;.&lt;/p&gt;

</description><author>gshark@gmail.com (Edu Herraiz)</author><pubDate>Tue, 28 Jun 2011 11:17:18 +0000</pubDate><guid>http://www.eduherraiz.com/blog/2011/06/28/script-para-sincronizar-carpeta-remota-via-rsync/</guid><category>Sin categoría</category></item></channel></rss>